{% extends "base.html" %}
{% load static %}

{% block main %}

<style>
.dropzone h5 {
    color: white;
    position: absolute;
    top: 50%;
    left: 50%; 
    transform: translate(-50%, -50%);
    margin: 0;
    font-size: 1rem;
    transition: left 0.3s ease, transform 0.3s ease; 
}

.dropzone {
    border: 2.5px dashed #ffffff;
    background-color: #3b3d49;
    min-height: 80px;
    display: flex;
    align-items: center;
    justify-content: center;
    position: relative;
    transition: padding-left 0.3s ease; 
    padding-left: 0; 
    
}


.dropzone.has-cards {
    padding-left: 100px; 
}

.dropzone.has-cards h5 {
    left: 20px; 
    transform: translateY(-50%) translateX(0); 
}

.dropped-cards-container {
    display: flex;
    gap: 10px;
    justify-content: center;
    align-items: center;
    flex-wrap: wrap;
    transition: all 0.3s ease; 
}

.dropped-card {
    width: auto;
    padding: 10px;
    background-color: #fff;
    color: #000;
    border-radius: 5px;
    text-align: center;
    font-size: 1rem;
    border: 1px solid #ddd;
    opacity: 0;
    transform: scale(0.8);
    transition: opacity 0.3s ease, transform 0.3s ease; 
}

.dropped-card.visible {
    opacity: 1;
    transform: scale(1); 
}


.dustbin {
    position: absolute;
    right: 10px;
    top: 50%;
    transform: translateY(-50%);
    cursor: pointer;
    width: 40px;
    height: 40px;
}

.dustbin svg {
    fill: white;
    width: 100%;
    height: 100%;
}

  
.proceed-button {
    display: block;
    padding: 12px;
    text-align: center;
    background-color: #ef6603; 
    color: white;
    border: none;
    border-radius: 15px;
    font-size: 1.2rem;
    margin-top: 20px;
    margin-left:45%;
    cursor: pointer;
    transition: background-color 0.3s ease;
}
.col-md-2 {
  flex: 0 0 auto;
  width: 20%;

.proceed-button:hover {
    background-color: #ff8c00;
}

.card-hover {
  position: relative;
  overflow: hidden;
  text-align: center;
  border: 1px solid #ddd;
  border-radius: 8px;
  transition: transform 0.3s ease;
}

.card-hover:hover {
  transform: scale(1.05);
}

.card-image {
  position: relative;
  padding: 15px;
}

.card-image img {
  width: 100%;
  height: auto;
  border-radius: 8px 8px 0 0;
}

.card-title {
  margin-top: 10px;
  font-size: 1rem;
  font-weight: bold;
}

.card-hover-content {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.7);
  color: #fff;
  display: flex;
  align-items: center;
  justify-content: center;
  flex-direction: column;
  opacity: 0;
  transition: opacity 0.3s ease;
  border-radius: 8px;
}

.card-hover:hover .card-hover-content {
  opacity: 1;
}


.card-hover-content .card-text {
  margin: 0;
  font-size: 0.9rem;
  padding: 0 10px;
}

#pipelinesTable {
  width: 100%;
  border-collapse: collapse;
  margin-top: 20px;
  display: none; /* Initially hide the table */
  box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
}
#pipelinesTable th, #pipelinesTable td {
  border: 1px solid #ddd;
  padding: 12px;
  text-align: left;
}
#pipelinesTable th {
  background-color: #f4f4f4;
  font-weight: bold;
  color: #333;
}
#pipelinesTable tbody tr {
  transition: background-color 0.3s;
}
#pipelinesTable tbody tr:hover {
  background-color: #f9f9f9;
}
.btn {
  padding: 5px 10px;
  border: none;
  cursor: pointer;
  border-radius: 4px;
  font-size: 0.9em;
}
.btn-warning {
  background-color: #f0ad4e;
  color: white;
}
.btn-primary {
  background-color: #0275d8;
  color: white;
}
.btn-danger {
  background-color: #d9534f;
  color: white;
}
.status {
  font-weight: bold;
  color: green;
}
.table-container {
  width: 80%;
  margin: 20px auto;
  border-collapse: collapse;
}
table {
  width: 100%;
  border: 1px solid #ddd;
}
th, td {
  padding: 10px;
  text-align: left;
}
th {
  background-color: #f4f4f4;
  cursor: pointer;
}
th, td {
  border-bottom: 1px solid #ddd;
}
.group-header {
  font-weight: bold;
  background-color: #efefef;
}
.search-input {
  margin: 10px 0;
  padding: 8px;
  width: 100%;
}
.actions {
  display: flex;
  gap: 10px;
}
.edit-btn, .delete-btn {
  cursor: pointer;
  color: #007bff;
}

</style>

</head>
<main class="main">

  <section id="about" class="about section" style="padding:1px">
    <div class="container">
      <div class="container my-5">
        <div class="row justify-content-center">
          <div class="col-md-2 col-sm-4 col-6 mb-3">
            <div class="card card-hover" draggable="true" ondragstart="drag(event)" id="card1">
              <div class="card-image">
                <img src="{% static 'assets/img/Preprocessing.jpg' %}" class="card-img-top" alt="Card Image" style="height:145px;">
                <h5 class="card-title">Pre Processing</h5>
              </div>
              <div class="card-hover-content">
                <p class="card-text">Preprocessing data involves cleaning, transforming, and organizing raw data to prepare it for analysis or modeling.</p>
              </div>
            </div>
          </div>
          <div class="col-md-2 col-sm-4 col-6 mb-4">
            <div class="card card-hover" draggable="true" ondragstart="drag(event)" id="card2">
              <div class="card-image">
                <img src="{% static 'assets/img/classification.jpg' %}" class="card-img-top" alt="Card Image" style="height:145px;">
                <h5 class="card-title">Classification</h5>
              </div>
              <div class="card-hover-content">
                <p class="card-text">Classification data refers to labeled data used in machine learning to categorize items into predefined classes or groups based on their features.</p>
              </div>
            </div>
          </div>
          <div class="col-md-2 col-sm-4 col-6 mb-4" >
            <div class="card card-hover" draggable="true" ondragstart="drag(event)" id="card3" >
              <div class="card-image">
                <img src="{% static 'assets/img/Demo.jpg' %}" class="card-img-top" alt="Card Image" style="height:145px;" >
                <h5 class="card-title">Extraction</h5>
              </div>
              <div class="card-hover-content">
                <p class="card-text">Data extraction is the process of retrieving relevant information from various sources for analysis or processing.</p>
              </div>
            </div>
          </div>
          <div class="col-md-2 col-sm-4 col-6 mb-4">
            <div class="card card-hover" draggable="true" ondragstart="drag(event)" id="card4">
              <div class="card-image">
                <img src="{% static 'assets/img/Validation.jpg' %}" class="card-img-top" alt="Card Image" style="height:145px;">
                <h5 class="card-title">Post Processing</h5>
              </div>
              <div class="card-hover-content">
                <p class="card-text">Post-processing is the refinement or enhancement of outputs after the primary process to improve quality or usability.</p>
              </div>
            </div>
          </div>
          <div class="col-md-2 col-sm-4 col-6 mb-4">
            <div class="card card-hover" draggable="true" ondragstart="drag(event)" id="card5">
              <div class="card-image">
                <img src="{% static 'assets/img/Posting.jpg' %}" class="card-img-top" alt="Card Image" style="height:145px;">
                <h5 class="card-title">Validation</h5>
              </div>
              <div class="card-hover-content">
                <p class="card-text">Validation data is a subset of data used to assess the performance of a model during training, ensuring it generalizes well to unseen data.</p>
              </div>
            </div>
          </div>
        </div>
      </div>

      

    <div class="container-fluid py-3 text-white dropzone" ondrop="drop(event)" ondragover="allowDrop(event)">
      <h5>Drag cards here: </h5>
      <div class="dropped-cards-container"></div>

      <div class="dustbin" ondrop="deleteAllCards(event)" ondragover="allowDrop(event)">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M3 6h18M9 6v12M15 6v12M3 6h18"></path>
          <path d="M19 7l-1.5 12h-13L5 7"></path>
          <path d="M10 18h4"></path>
        </svg>
      </div>
    </div>

    <div class="container mb-2">
      <label for="pipelineName" style="color: white;"></label>
      <input type="text" id="pipelineName" placeholder="Enter pipeline name" style="width: 50%; padding: 7px; border-radius: 5px; border: 1px solid #ef6603; margin:30px 0px 0px 300px;">
    </div>


    <button class="proceed-button mb-3" onclick="createPipeline()">Create Pipeline</button>
    
    <h2 style="font-family: Arial, sans-serif; color: #333; margin-bottom: 20px;">Grouped Table with Filters</h2>
    <input type="text" id="search" class="search-input" placeholder="Search by pipeline name..." style="margin: 0 0 20px auto; padding: 8px 12px; font-size: 16px; border: 1px solid #ccc; border-radius: 5px; display: block; width: 300px;">
    <div class="table-container" style="width: 100%; overflow-x: auto; margin-bottom: 30px;">
      <table id="pipelinesTable" style="width: 100%; border-collapse: collapse; border: 1px solid #ddd; font-family: Arial, sans-serif;">
        <thead style="background-color: #f1f1f1; color: #333;">
          <tr style="border: 1px solid #ddd; padding: 12px; cursor: pointer;">
            <th>S.No</th>
            <th>Pipeline Name</th>
            <th>Features</th>
            <th>Status</th>
            <th>Pages Processed</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
    


    
</div>

<!-- Add pipeline detail popup -->
<div id="pipelinePopup" style="display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: #fff; padding: 20px; border-radius: 10px; z-index: 1000; box-shadow: 0px 0px 10px rgba(0,0,0,0.5);">
  <h3>Pipeline Details</h3>
  <p id="popupPipelineName" style="font-weight: bold;"></p>
  <ul id="popupFeaturesList"></ul>
  <button onclick="closePopup()" style="margin-top: 10px; padding: 10px; background-color: #ef6603; color: white; border: none; border-radius: 5px;">Close</button>
</div>

<script>
  let addedCardIds = [];
  let pipelineCount = 0; // Tracks row number
  
  // Drag and drop handlers
  function allowDrop(event) {
    event.preventDefault();
  }
  
  function drag(event) {
    event.dataTransfer.setData("text", event.target.id);
  }
  
  function drop(event) {
    event.preventDefault();
    const cardId = event.dataTransfer.getData("text");
    const card = document.getElementById(cardId);
  
    if (addedCardIds.includes(cardId)) {
      alert("This card has already been added!");
      return;
    }
  
    addedCardIds.push(cardId);
    const cardTitle = card.querySelector('.card-title').textContent;
    const droppedCard = document.createElement('div');
    droppedCard.className = 'dropped-card';
    droppedCard.textContent = cardTitle;
    droppedCard.setAttribute("id", cardId);
    droppedCard.setAttribute("draggable", "true");
    droppedCard.ondragstart = function (event) { drag(event) };
  
    document.querySelector('.dropped-cards-container').appendChild(droppedCard);
    setTimeout(() => droppedCard.classList.add('visible'), 10);
  }
  
  function deleteAllCards(event) {
    if (event) event.preventDefault();
    document.querySelector('.dropped-cards-container').innerHTML = '';
    addedCardIds = [];
  }
  
  function createPipeline() {
    const pipelineName = document.getElementById("pipelineName").value.trim();
    const features = document.querySelectorAll('.dropped-cards-container .dropped-card');
  
    if (!pipelineName) {
      alert("Please enter a pipeline name!");
      return;
    }
  
    const table = document.getElementById("pipelinesTable");
    if (Array.from(table.querySelectorAll('.pipeline-title')).map(el => el.textContent).includes(pipelineName)) {
      alert("A pipeline with this name already exists.");
      return;
    }
  
    if (features.length === 0) {
      alert("Please add at least one feature!");
      return;
    }
  
    const featureList = Array.from(features).map(feature => feature.textContent);
    const tableBody = table.querySelector('tbody');
    pipelineCount++;
  
    const newRow = document.createElement('tr');
    newRow.innerHTML = `
      <td>${pipelineCount}</td>
      <td class="pipeline-title">${pipelineName}</td>
      <td>${featureList.join(', ')}</td>
      <td>
        <select onchange="changeStatus(this)" style="padding: 4px;">
          <option value="Active">Active</option>
          <option value="Inactive">Inactive</option>
        </select>
      </td>
      <td>0</td>
      <td>
        <button onclick="renamePipeline(this)" style="border: none; background: none;">
          <svg width="16" height="16" fill="#007bff" viewBox="0 0 16 16">
            <path d="M15.854 1.854a.5.5 0 0 0-.708-.708l-2-2a.5.5 0 0 0-.708.708l2 2a.5.5 0 0 0 .708 0zM4.5 10.5v2h2l8-8-2-2-8 8z"/>
          </svg>
        </button>
        <button onclick="deletePipeline(this)" style="border: none; background: none;">
          <svg width="16" height="16" fill="#dc3545" viewBox="0 0 16 16">
            <path d="M5.5 5a.5.5 0 0 1 .5.5v7a.5.5 0 0 1-1 0v-7a.5.5 0 0 1 .5-.5zM7.5 5a.5.5 0 0 1 .5.5v7a.5.5 0 0 1-1 0v-7a.5.5 0 0 1 .5-.5zM9.5 5a.5.5 0 0 1 .5.5v7a.5.5 0 0 1-1 0v-7a.5.5 0 0 1 .5-.5zM11.5 5a.5.5 0 0 1 .5.5v7a.5.5 0 0 1-1 0v-7a.5.5 0 0 1 .5-.5z"/>
            <path d="M14.5 3h-13a.5.5 0 0 1 0-1h13a.5.5 0 0 1 0 1z"/>
          </svg>
        </button>
      </td>
    `;
    
    tableBody.appendChild(newRow);
    deleteAllCards();
  }
  
  function renamePipeline(button) {
    const row = button.closest('tr');
    const nameCell = row.querySelector('.pipeline-title');
    const newName = prompt("Enter a new name:", nameCell.textContent);
    
    if (newName && !Array.from(document.querySelectorAll('.pipeline-title')).some(el => el.textContent === newName)) {
      nameCell.textContent = newName;
    } else {
      alert("Invalid or duplicate name.");
    }
  }
  
  function deletePipeline(button) {
    const row = button.closest('tr');
    row.remove();
  }
   
  document.getElementById('search').addEventListener('input', function () {
    const searchValue = this.value.toLowerCase();
    document.querySelectorAll('tbody tr').forEach(row => {
      const pipelineName = row.querySelector('.pipeline-title').textContent.toLowerCase();
      row.style.display = pipelineName.includes(searchValue) ? '' : 'none';
    });
  });
  
</script>


{% endblock main %}
   