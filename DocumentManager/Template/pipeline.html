{% extends "base.html" %}
{% load static %}

{% block main %}

<style>
  .dropzone h5 {
    color: white;
    position: absolute;
    top: 50%;
    left: 50%; 
    transform: translate(-50%, -50%);
    margin: 0;
    font-size: 1rem;
    transition: left 0.3s ease, transform 0.3s ease; 
}

.dropzone.dragged h5 {
  left: 20px; 
    transform: translateY(-50%) translateX(0); 
}

.dropzone {
  border: 2.5px dashed #ffffff;
  background-color: #3b3d49;
  min-height: 80px;
  display: flex;
  align-items: center;
  justify-content: center;
  position: relative;
  transition: padding-left 0.3s ease; 
  padding-left: 0;
  margin-top: 140px;
  flex-wrap: wrap; 
}

.dropzone.has-cards {
    padding-left: 100px; 
}

.dropped-cards-container {
  display: flex;
  gap: 10px;
  justify-content: center;
  align-items: center;
  flex-wrap: wrap;
  transition: all 0.3s ease; 
}

.dropped-card {
  flex: 1 1 calc(25% - 10px); 
  max-width: 200px; 
  padding: 10px;
  background-color: #fff;
  color: #000;
  border-radius: 5px;
  text-align: center;
  font-size: 1rem;
  border: 1px solid #ddd;
  opacity: 0;
  transform: scale(0.8);
  transition: opacity 0.3s ease, transform 0.3s ease; 
}

.dropped-card.visible {
    opacity: 1;
    transform: scale(1); 
}


.dustbin {
    position: absolute;
    right: 10px;
    top: 50%;
    transform: translateY(-50%);
    cursor: pointer;
    width: 40px;
    height: 40px;
}

.dustbin svg {
    fill: white;
    width: 100%;
    height: 100%;
}

  
.proceed-button {
  padding: 8px;
  text-align: center;
  background-color: #ef6603; 
  color: white;
  border: none;
  border-radius: 15px;
  font-size: 1.2rem;
  margin: 18px auto; 
  cursor: pointer;
  transition: background-color 0.3s ease;
  width: 20%; 
}


.col-md-2 {
  flex: 0 0 auto;
  width: 15%;
  height:70px;

.proceed-button:hover {
    background-color: #ff8c00;
}

.card-hover {
  position: relative;
  overflow: hidden;
  text-align: center;
  border: 1px solid #ddd;
  border-radius: 8px;
  transition: transform 0.3s ease;
}

.card-hover:hover {
  transform: scale(1.05);
}

.card-image {
  position: relative;
  padding: 15px;
}

.card-image img {
  width: 100%;
  height: auto;
  border-radius: 8px 8px 0 0;
}

.card-title {
  margin-top: 10px;
  font-size: 1rem;
  font-weight: bold;
}

.card-hover-content {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.7);
  color: #fff;
  display: flex;
  align-items: center;
  justify-content: center;
  flex-direction: column;
  opacity: 0;
  transition: opacity 0.3s ease;
  border-radius: 8px;
}

.card-hover:hover .card-hover-content {
  opacity: 1;
}


.card-hover-content .card-text {
  margin: 0;
  font-size: 0.9rem;
  padding: 0 10px;
}

#pipelinesTable {
  width: 100%;
  border-collapse: collapse;
  margin-top: 20px;
  display: none; /* Initially hide the table */
  box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
}
#pipelinesTable th, #pipelinesTable td {
  border: 1px solid #ddd;
  padding: 12px;
  text-align: left;
}
#pipelinesTable th {
  background-color: #f4f4f4;
  font-weight: bold;
  color: #333;
}
#pipelinesTable tbody tr {
  transition: background-color 0.3s;
}
#pipelinesTable tbody tr:hover {
  background-color: #f9f9f9;
}
.status {
  font-weight: bold;
  color: green;
}
.table-container {
  width: 80%;
  margin: 20px auto;
  border-collapse: collapse;
}
table {
  width: 100%;
  border: 1px solid #ddd;
}
th, td {
  padding: 10px;
  text-align: left;
}
th {
  background-color: #f4f4f4;
  cursor: pointer;
}
th, td {
  border-bottom: 1px solid #ddd;
}
.group-header {
  font-weight: bold;
  background-color: #efefef;
}
.search-input {
  margin: 10px 0;
  padding: 8px;
  width: 100%;
}
.actions {
  display: flex;
  gap: 10px;
}
.edit-btn, .delete-btn {
  cursor: pointer;
  color: #007bff;
}

@media (max-width: 480px) {
  .dropped-card {
      flex: 1 1 100%; 
  }
  
  .proceed-button {
      font-size: 1rem; 
  }
}



</style>

<main class="main">

  <section id="about" class="about section" style="padding:1px">
    <div class="container">
      <div class="container my-1">
        <div class="row justify-content-center">
          <div class="col-md-2 col-sm-4 col-6 mb-3">
            <div class="card card-hover" draggable="true" ondragstart="drag(event)" id="card1">
              <div class="card-image">
                <img src="{% static 'assets/img/Preprocessing.jpg' %}" class="card-img-top" alt="Card Image">
                <h5 class="card-title">Pre Processing</h5>
              </div>
              <div class="card-hover-content">
                <p class="card-text">Preprocessing data involves cleaning, transforming, and organizing raw data to prepare it for analysis or modeling.</p>
              </div>
            </div>
          </div>
          <div class="col-md-2 col-sm-4 col-6 mb-3">
            <div class="card card-hover" draggable="true" ondragstart="drag(event)" id="card2">
              <div class="card-image">
                <img src="{% static 'assets/img/classification.jpg' %}" class="card-img-top" alt="Card Image" >
                <h5 class="card-title">Classification</h5>
              </div>
              <div class="card-hover-content">
                <p class="card-text">Classification data refers to labeled data used in machine learning to categorize items into predefined classes or groups based on their features.</p>
              </div>
            </div>
          </div>
          <div class="col-md-2 col-sm-4 col-6 mb-3">
            <div class="card card-hover" draggable="true" ondragstart="drag(event)" id="card3">
              <div class="card-image" >
                <img src="{% static 'assets/img/Demo.jpg' %}" class="card-img-top" alt="Card Image">
                <h5 class="card-title">Extraction</h5>
              </div>
              <div class="card-hover-content">
                <p class="card-text">Data extraction is the process of retrieving relevant information from various sources for analysis or processing.</p>
              </div>
            </div>
          </div>
          <div class="col-md-2 col-sm-4 col-6 mb-3">
            <div class="card card-hover" draggable="true" ondragstart="drag(event)" id="card4">
              <div class="card-image">
                <img src="{% static 'assets/img/Validation.jpg' %}" class="card-img-top" alt="Card Image" >
                <h5 class="card-title">Post Processing</h5>
              </div>
              <div class="card-hover-content">
                <p class="card-text">Post-processing is the refinement or enhancement of outputs after the primary process to improve quality or usability.</p>
              </div>
            </div>
          </div>
          <div class="col-md-2 col-sm-4 col-6 mb-3">
            <div class="card card-hover" draggable="true" ondragstart="drag(event)" id="card5">
              <div class="card-image">
                <img src="{% static 'assets/img/Posting.jpg' %}" class="card-img-top" alt="Card Image" style="height:120px;">
                <h5 class="card-title">Validation</h5>
              </div>
              <div class="card-hover-content">
                <p class="card-text">Validation data is a subset of data used to assess the performance of a model during training, ensuring it generalizes well to unseen data.</p>
              </div>
            </div>
          </div>
          <div class="col-md-2 col-sm-4 col-6 mb-3">
            <div class="card card-hover" draggable="true" ondragstart="drag(event)" id="card6">
              <div class="card-image">
                <img src="{% static 'assets/img/Demo.jpg' %}" class="card-img-top" alt="Card Image">
                <h5 class="card-title">Deployment</h5>
              </div>
              <div class="card-hover-content">
                <p class="card-text">Deployment is the process of putting a completed model into production, making it available for use in real-world applications.</p>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="container-fluid py-3 text-white dropzone" ondrop="drop(event)" ondragover="allowDrop(event)">
        <h5>Drag cards here: </h5>
        <div class="dropped-cards-container"></div>
    
        <div class="dustbin" ondrop="deleteAllCards(event)" ondragover="allowDrop(event)">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M3 6h18M9 6v12M15 6v12M3 6h18"></path>
                <path d="M19 7l-1.5 12h-13L5 7"></path>
                <path d="M10 18h4"></path>
            </svg>
        </div>
    </div>
    
    <!-- Pipeline Name and Create Pipeline Button on the same line -->
    <div class="pipeline-name-container">
      <div style="display: flex; align-items: center; color: white;">
        <input type="text" id="pipelineName" placeholder="Enter pipeline name" style="margin-top:10px; width:75%;">
        <button class="proceed-button" onclick="createPipeline()" style="margin-left:30px;">
            Create Pipeline
        </button>
    </div>
    
  </div>
</div>

    <!-- Content to be toggled -->
    <div class="container">
    <div id="tableSection" style="display: none;">
      <h2 style="font-family: Arial, sans-serif; color: #333; margin-bottom: 20px;"></h2>
      <input
        type="text"
        id="search"
        class="search-input"
        placeholder="Search by pipeline name..."
        style="margin: 0 0 20px auto; padding: 8px 12px; font-size: 16px; border: 1px solid #ccc; border-radius: 5px; display: block; width: 300px;"
      />
      <div class="table-container" style="width: 100%; overflow-x: auto; margin-bottom: 30px;">
        <table id="pipelinesTable" class="table table-striped table-hover align-middle">
          <thead class="table-dark">
            <tr>
              <th scope="col">S.No</th>
              <th scope="col">Pipeline Name</th>
              <th scope="col">Features</th>
              <th scope="col">Status</th>
              <th scope="col">Pages Processed</th>
              <th scope="col">Actions</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </div>
  </div>

    <!-- Add pipeline detail popup -->
    <div id="pipelinePopup" style="display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: #fff; padding: 20px; border-radius: 10px; z-index: 1000; box-shadow: 0px 0px 10px rgba(0,0,0,0.5);">
      <h3>Pipeline Details</h3>
      <p id="popupPipelineName" style="font-weight: bold;"></p>
      <ul id="popupFeaturesList"></ul>
      <button onclick="closePopup()" style="margin-top: 10px; padding: 10px; background-color: #ef6603; color: white; border: none; border-radius: 5px;">Close</button>
    </div>

<script>
  let addedCardIds = [];
  let pipelineCount = 0; // Tracks row number
  
  // Drag and drop handlers
  function allowDrop(event) {
    event.preventDefault();
  }
  
  function drag(event) {
    event.dataTransfer.setData("text", event.target.id);
  }
  function resetDropzone() {
  const dropzone = document.querySelector('.dropzone');
  dropzone.classList.remove('dragged');
  }

  
  function drop(event) {
  event.preventDefault();
  const cardId = event.dataTransfer.getData("text");
  const card = document.getElementById(cardId);

  if (addedCardIds.includes(cardId)) {
    alert("This card has already been added!");
    return;
  }

  addedCardIds.push(cardId);
  const cardTitle = card.querySelector('.card-title').textContent;
  const droppedCard = document.createElement('div');
  droppedCard.className = 'dropped-card';
  droppedCard.textContent = cardTitle;
  droppedCard.setAttribute("id", cardId);
  droppedCard.setAttribute("draggable", "true");
  droppedCard.ondragstart = function (event) { drag(event) };

  document.querySelector('.dropped-cards-container').appendChild(droppedCard);

  // Add the transition effect
  const dropzone = document.querySelector('.dropzone');
  dropzone.classList.add('dragged');
  setTimeout(() => droppedCard.classList.add('visible'), 10);
}

  
  function deleteAllCards(event) {
    if (event) event.preventDefault();
    document.querySelector('.dropped-cards-container').innerHTML = '';
    addedCardIds = [];
  }
  
  function createPipeline() {
    
    const pipelineName = document.getElementById("pipelineName").value.trim();
    const features = document.querySelectorAll('.dropped-cards-container .dropped-card');
  
    if (!pipelineName) {
      alert("Please enter a pipeline name!");
      return;
    }
  
    const table = document.getElementById("pipelinesTable");
    if (Array.from(table.querySelectorAll('.pipeline-title')).map(el => el.textContent).includes(pipelineName)) {
      alert("A pipeline with this name already exists.");
      return;
    }
  
    if (features.length === 0) {
      alert("Please add at least one feature!");
      return;
    }

    const tableSection = document.getElementById("tableSection");
    tableSection.style.display = "block";
  
    const featureList = Array.from(features).map(feature => feature.textContent);
    const tableBody = table.querySelector('tbody');
    pipelineCount++;
  
    const newRow = document.createElement('tr');
    newRow.innerHTML = `
  <td>${pipelineCount}</td>
  <td class="pipeline-title" style="color: black; ">${pipelineName}</td>
  <td style="color: #212529;">${featureList.join(', ')}</td>
  <td>
    <select onchange="changeStatus(this)" style="padding: 4px; border-radius: 4px; border: 1px solid #ccc; background-color: #2e2f37; color: #ffffff;">
      <option value="Active" style="color: #4caf50;">Active</option>
      <option value="Inactive" style="color: #ff5722;">Inactive</option>
    </select>
  </td>
  <td style="color: #212529;">0</td>
  <td>
    <button onclick="renamePipeline(this)" style="border: none; background: none; padding: 0; margin: 0; margin-right: 12px; cursor: pointer;">
      <svg fill="#4f4dff" width="18px" height="18px" version="1.1" viewBox="144 144 512 512" xmlns="http://www.w3.org/2000/svg" stroke="#4f4dff">
        <g id="SVGRepo_iconCarrier">
          <path d="m563.97 163.84c-18.242 0-36.484 7.125-50.723 21.359l-2.4297 2.4141 101.55 101.55 2.3242-2.3125c28.477-28.477 28.477-73.18 0-101.66-14.238-14.238-32.484-21.359-50.723-21.359zm-95.359 65.996-229.69 229.68c-3.5977 3.5977-15.664 22.711-26.457 46.312-20.586 45.324-34.277 85.445-48.52 130.33 37.887-12.207 86.391-28.996 130.11-48.742 23.605-10.793 42.938-22.855 46.539-26.457l229.65-229.65z"></path>
        </g>
      </svg>
    </button>
    <button onclick="deletePipeline(this)" style="border: none; background: none; padding: 0; margin: 0; cursor: pointer;">
      <svg fill="#ff0000" width="18px" height="18px" version="1.1" viewBox="144 144 512 512" xmlns="http://www.w3.org/2000/svg" stroke="#ff0000">
        <g id="SVGRepo_iconCarrier">
          <g>
            <path d="m246.55 553.14c1.7344 19.832 10.809 38.301 25.449 51.793 14.637 13.492 33.785 21.035 53.691 21.152h143.38c19.906-0.11719 39.055-7.6602 53.691-21.152 14.637-13.492 23.711-31.961 25.449-51.793l13.434-161.01h-328.52zm182.32-90.16c0-7.2461 5.875-13.121 13.121-13.121s13.117 5.875 13.117 13.121v62.977-0.003906c0 7.2461-5.8711 13.121-13.117 13.121s-13.121-5.875-13.121-13.121zm-83.969 0c0-7.2461 5.875-13.121 13.121-13.121s13.117 5.875 13.117 13.121v62.977-0.003906c0 7.2461-5.8711 13.121-13.117 13.121s-13.121-5.875-13.121-13.121z"></path>
            <path d="m515.17 260.93-10.559-42.227c-2.9648-11.93-9.8398-22.523-19.527-30.09-9.6914-7.5664-21.637-11.668-33.93-11.652h-102.38c-12.293-0.011719-24.238 4.0898-33.926 11.656-9.6914 7.5664-16.57 18.156-19.539 30.086l-10.496 42.227h-31.762c-14.617 0.007813-28.629 5.8164-38.969 16.148-10.336 10.332-16.152 24.34-16.168 38.957v20.992c0.011719 9.0469 3.6133 17.723 10.016 24.117 6.4023 6.3984 15.078 9.9922 24.129 9.9922h335.87c9.0391-0.019531 17.703-3.6172 24.09-10.012 6.3867-6.3945 9.9805-15.059 9.9922-24.098v-20.992c-0.015625-14.605-5.8242-28.605-16.148-38.938-10.32-10.328-24.32-16.145-38.926-16.168z"></path>
          </g>
        </g>
      </svg>
    </button>
  </td>
`;

    
    tableBody.appendChild(newRow);
    deleteAllCards();
  }
  
  function renamePipeline(button) {
    const row = button.closest('tr');
    const nameCell = row.querySelector('.pipeline-title');
    const newName = prompt("Enter a new name:", nameCell.textContent);
    
    if (newName && !Array.from(document.querySelectorAll('.pipeline-title')).some(el => el.textContent === newName)) {
      nameCell.textContent = newName;
    } else {
      alert("Invalid or duplicate name.");
    }
  }
  
  function deletePipeline(button) {
    const row = button.closest('tr');
    row.remove();
  }
   
  document.getElementById('search').addEventListener('input', function () {
    const searchValue = this.value.toLowerCase();
    document.querySelectorAll('tbody tr').forEach(row => {
      const pipelineName = row.querySelector('.pipeline-title').textContent.toLowerCase();
      row.style.display = pipelineName.includes(searchValue) ? '' : 'none';
    });
  });
  
</script>


{% endblock main %}
   